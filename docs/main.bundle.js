!function(t){var e={};function n(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(s,i,function(e){return t[e]}.bind(null,i));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=7)}([function(t,e,n){t.exports=n.p+"3e2265fe52e00d2ce11bc62ecc87e8dc.ogg"},function(t,e,n){t.exports=n.p+"127f259c6091320e9751edb5d252ff69.ogg"},function(t,e,n){t.exports=n.p+"eab9abdd88bf6a2d3feee9bbe1503511.ogg"},function(t,e,n){t.exports=n.p+"6ed1697429f33ffbb7e561144fdb41bf.ogg"},function(t,e,n){t.exports=n.p+"58b588d535bbf9e81f2d61e4cbda5442.ogg"},function(t,e,n){t.exports=n.p+"2c10e3b1945ba8958b1f1f662a76ca53.png"},function(t,e,n){},function(t,e,n){"use strict";n.r(e);n(6);const s={90:"a",88:"b",67:"menu",87:"up",83:"down",65:"left",68:"right",32:"a",16:"b",13:"menu",38:"up",40:"down",37:"left",39:"right"};class i{constructor(t,e=-1){this.element=t,this.keyUp=(t=>{this.dispatch(t,"release")}),this.keyDown=(t=>{this.dispatch(t,"press")}),this.blur=(t=>{this.handler&&this.handler.block&&this.handler.block()}),t.addEventListener("keyup",this.keyUp,!1),t.addEventListener("keydown",this.keyDown,!1),t.addEventListener("blur",this.blur,!1),t.setAttribute("tabindex",e+"")}dispose(){this.element.removeEventListener("keyup",this.keyUp,!1),this.element.removeEventListener("keydown",this.keyDown,!1),this.element.removeEventListener("blur",this.blur,!1)}setHandler(t){this.handler&&this.handler.block&&this.handler.block(),this.handler=t,this.handler&&this.handler.activate&&this.handler.activate()}dispatch(t,e){let n=s[t.which];null!=n&&this.handler&&(t.preventDefault(),t.stopPropagation(),"press"==e&&this.handler.press?this.handler.press(n):"release"==e&&this.handler.release&&this.handler.release(n))}focus(){this.element.focus()}}class o{constructor(t,e,n){this.fps=t,this.physicsCallback=e,this.renderCallback=n,this.lastPhysicsTick=(new Date).getTime()}start(){null==this.physicsTimeout&&(this.physicsTimeout=window.setTimeout(()=>{this.physicsTimeout=void 0,this.physicsTick(1/this.fps)},1e3/this.fps)),null==this.renderTimeout&&(this.renderTimeout=window.requestAnimationFrame(()=>{this.renderTimeout=void 0,this.renderTick()}))}stop(){null!=this.physicsTimeout&&(window.clearTimeout(this.physicsTimeout),this.physicsTimeout=void 0),null!=this.renderTimeout&&(window.cancelAnimationFrame(this.renderTimeout),this.renderTimeout=void 0)}physicsTick(t){const e=(new Date).getTime();this.lastPhysicsTick=e,this.physicsCallback(t),this.start()}renderTick(){const t=(new Date).getTime();this.renderCallback((t-this.lastPhysicsTick)/1e3),this.start()}}class a{constructor(){this.x=0,this.y=0,this.zoom=1}}class r{constructor(t,e=1,n=1){this.z=t,this.parallax=e,this.scale=n,this.Camera=new a}enter(t){const e=this.Camera,n=this.scale*e.zoom,s=this.parallax;t.save(),t.scale(n,n),t.translate(-e.x*s,-e.y*s)}exit(t){t.restore()}toRender(t){return{z:this.z,render:(e,n)=>{this.enter(e),t(e,n),this.exit(e)}}}}class h{constructor(){this.renderables=[]}queue(...t){this.renderables.push(...t)}draw(t,e=0){this.renderables.sort((t,e)=>t.z-e.z);for(const{z:n,render:s}of this.renderables)s(t,e);this.renderables.length=0}}var l;!function(t){t[t.DEAD=0]="DEAD",t[t.ALIVE=1]="ALIVE",t[t.INACTIVE=2]="INACTIVE"}(l||(l={}));class c{constructor(){this.entity=[]}}function d(t,e,n=l.ALIVE){const s=t.entity;let i=-1,o=-1;for(let t=0;t<s.length;t++)if(s[t].alive==l.DEAD){i=t,o=s[t].generation+1;break}-1==i&&(i=s.length,o=1),s[i]={generation:o,alive:n};for(const n in e)t[n][i]=Object.assign({},e[n],{generation:o});return[i,o]}function u(t,[e,n],s=l.DEAD){t.entity[e]&&t.entity[e].generation==n&&(t.entity[e].alive=s)}function f(t,[e,n],...s){const i=t.entity[e];return i&&i.generation==n&&i.alive!=l.DEAD?s.map(s=>{const i=t[s][e];return i&&i.generation==n?i:null}):s.map(()=>null)}function w(t,...e){const n=t.entity,s=e.map(e=>t[e]),i=[],o=s[0];if(Array.isArray(o))for(let t=0;t<o.length;t++)p(t,n,s,i);else for(const t in o)p(Number(t),n,s,i);return i}function p(t,e,n,s){const i=[[t,-1]];let o=-1;for(const e of n){const n=e[t];if(!n||n.generation!=o&&-1!=o)return;o=n.generation,i.push(n)}const a=e[t];a.alive==l.ALIVE&&o==a.generation&&(i[0][1]=o,s.push(i))}class g{constructor(t){this.points=t}}class m{constructor(t){this.X=0,this.Y=0,this.Angle=0,this.VX=0,this.VY=0,this.VAngle=0,t&&Object.assign(this,t)}}class b{constructor(t){this.name=t}}class y{constructor(t="#f00",e){this.color=t,this.layer=e}}class v extends c{constructor(){super(...arguments),this.location=[],this.bounds=[],this.renderBounds={},this.renderSprite={},this.collisionSourceClass={},this.collisionTargetClass={}}}function E(t,e,n=0){t.translate(e.X+e.VX*n,e.Y+e.VY*n),t.rotate(-e.Angle+e.VAngle*n)}function M({points:t},{X:e,Y:n,Angle:s}){const i=Math.sin(s),o=Math.cos(s),a=new g(new Array(t.length));for(let s=0;s<t.length;s+=2){const r=t[s],h=t[s+1];a.points[s]=r*o-h*i+e,a.points[s+1]=r*i+h*o+n}return a}function C({points:t},e){let n=1/0,s=1/0,i=-1/0,o=-1/0;for(let e=0;e<t.length;e+=2)n=Math.min(n,t[e]),s=Math.min(s,t[e+1]),i=Math.max(i,t[e]),o=Math.max(o,t[e+1]);return function(t,e,n,s,i){let o=Math.floor(t/i),a=Math.floor(e/i),r=Math.floor(n/i),h=Math.floor(s/i);const l=[];for(let t=o;t<=r;t++)for(let e=a;e<=h;e++)l.push(`${t},${e}`);return l}(n,s,i,o,e)}function A(t,e,n){let s=1/0,i=-1/0;for(let o=0;o<n.length;o+=2){const a=t*n[o]+e*n[o+1];s=Math.min(s,a),i=Math.max(i,a)}return[s,i]}function W(t,e,n,s){const[i,o]=A(t,e,n),[a,r]=A(t,e,s);return!(i<r&&a<o)}function L(t,e){for(let n=2;n<t.length;n+=2){const s=t[n]-t[n-2];if(W(-(t[n+1]-t[n-1]),s,t,e))return!1}const n=t[0]-t[t.length-2];return!W(-(t[1]-t[t.length-1]),n,t,e)}function Y({points:t},{points:e}){return L(t,e)&&L(e,t)}function N(t){t.currentTime=0,t.play()}var I=n(0),S=n.n(I),x=n(1),T=n.n(x),k=n(2),P=n.n(k);class V{constructor(){this.dx=0,this.dy=0,this.firing=!1,this.weaponCycle=!1,this.startGame=!1}press(t){switch(t){case"up":this.dy=-1;break;case"down":this.dy=1;break;case"left":this.dx=-1;break;case"right":this.dx=1;break;case"a":this.firing=!0;break;case"b":this.weaponCycle=!0;break;case"menu":this.startGame=!0}}release(t){switch(t){case"up":this.dy=Math.max(this.dy,0);break;case"down":this.dy=Math.min(this.dy,0);break;case"left":this.dx=Math.max(this.dx,0);break;case"right":this.dx=Math.min(this.dx,0);break;case"a":this.firing=!1}}block(){this.dx=0,this.dy=0,this.firing=!1,this.weaponCycle=!1}}var X=n(3),G=n.n(X),O=n(4),D=n.n(O),R=n(5);new class{constructor(t,e,n){this.img=t,this.w=e,this.h=n}render(t,e,n=0,s=0){if(this.img.width>0){const i=Math.floor(e*this.w/this.img.width),o=Math.floor(e*this.w%this.img.width),a=i*this.h;t.drawImage(this.img,o,a,this.w,this.h,n,s,this.w,this.h)}}}((B=n.n(R).a,Object.assign(new Image,{src:B})),500,400);var B;const H=new Audio(P.a),$=new Audio(G.a),j=new Audio(T.a),_=new Audio(D.a),F=new Audio(S.a);var z,q,K;!function(t){t[t.TITLE=0]="TITLE",t[t.PLAYING=1]="PLAYING",t[t.PAUSED=2]="PAUSED",t[t.LOST=3]="LOST",t[t.WON=4]="WON"}(z||(z={})),function(t){t[t.NONE=0]="NONE",t[t.SHOOTER=1]="SHOOTER",t[t.BACK_FLARE=2]="BACK_FLARE"}(q||(q={}));class U{constructor(t){this.level=t,this.width=500,this.height=400,this.playerInput=new V,this.phase=z.TITLE,this.respawnCooldown=0,this.lives=5,this.availableWeapons=[!1,!0,!0],this.score=0,this.groundLayer=new r(0),this.cloudLayer=new r(1),this.debugLayer=new r(2),this.bulletLayer=new r(10),this.shipLayer=new r(15),this.smokeLayer=new r(16),this.hudLayer=new r(20),this.bgColor=[255,255,255],this.debug={}}drawDebug(t,e){t.queue(this.hudLayer.toRender((t,n)=>{t.font="12px monospace",t.fillStyle=e;let s=12;for(const e in this.debug)t.textAlign="left",t.textBaseline="middle",t.fillText(`${e}: ${JSON.stringify(this.debug[e])}`,0,s,this.width),s+=14}))}drawHud(t){t.queue(this.hudLayer.toRender((t,e)=>{t.font="16px monospace",t.textAlign="left",t.textBaseline="middle";const n=`Lives: ${this.lives}`;t.fillStyle="#000",t.fillText(n,1,this.height-18+1,this.width/4),t.fillStyle="#0ff",t.fillText(n,0,this.height-18,this.width/4);const s=`Score: ${this.score}`;t.fillStyle="#000",t.fillText(s,this.width/3+1,this.height-18+1,this.width/4),t.fillStyle="#0ff",t.fillText(s,this.width/3,this.height-18,this.width/4);const i=`Weapon: ${this.debug.weapon}`;t.fillStyle="#000",t.fillText(i,2*this.width/3+1,this.height-18+1,this.width/4),t.fillStyle="#0ff",t.fillText(i,2*this.width/3,this.height-18,this.width/4)}))}}class J extends v{constructor(){super(...arguments),this.boss={},this.bullet={},this.hp={},this.lifetime={},this.message={},this.playerShip={},this.stalacfite={},this.swooparang={}}}class Z{constructor(){this.firingCooldown=0,this.mercyCooldown=2,this.currentWeapon=q.NONE}}!function(t){t[t.PLAYER=0]="PLAYER",t[t.ENEMY=1]="ENEMY"}(K||(K={}));class Q{constructor(t,e,n){this.team=t,this.weapon=e,this.attack=n,this.hit=!1}}class tt{constructor(t,e){this.team=t,this.hp=e,this.receivedDamage=0}}class et{constructor(t){this.time=t}}class nt{constructor(t){this.name=t,this.killedBy=q.NONE}}class st{constructor(t,e,n,s=3){this.layer=t,this.color=e,this.message=n,this.timeout=s,this.targetY=0}}function it(t,e){return function(n,s,i,o=0){return d(n,{location:new m({X:-s.width,Y:s.height/2,VX:s.width}),message:new st(s.cloudLayer,t,e,3+o)})}}const ot=16,at=20;function rt(t,e,n,s,i,o=Math.PI/2,a=100,r=400,h=K.PLAYER){return d(t,{bullet:new Q(h,i,a),collisionSourceClass:new b("bullet"),location:new m({X:n,Y:s,VX:r*Math.cos(o),VY:-r*Math.sin(o),Angle:o}),bounds:new g([0,-3,0,3,10,3,10,-3]),renderBounds:new y("#ff8",e.bulletLayer)})}function ht(t){switch(t){case q.SHOOTER:return"forward cannon";case q.BACK_FLARE:return"flare bombs";default:return"defenseless"}}const lt=30;function ct(t,e,n,s,i,o,a){for(let r=0;r<a;r++){dt(t,e,n,s,i,o,2*Math.PI*r/a)}}function dt(t,e,n,s,i,o,a){return d(t,{location:new m({X:n,Y:s,VX:400*(Math.random()+.5)*Math.cos(a),VY:400*(Math.random()+.5)*-Math.sin(a)}),bounds:new g([-i,-i,-i,i,i,i,i,-i]),renderBounds:new y(o,e.smokeLayer),lifetime:new et(Math.random()/3)})}function ut(t,e,n){const s=0==w(t,"playerShip").length;e.respawnCooldown>0?e.respawnCooldown=Math.max(e.respawnCooldown-n,0):s?e.lives>0?(!function(t,e){d(t,{playerShip:new Z,collisionTargetClass:new b("player"),hp:new tt(K.PLAYER,1),location:new m({X:e.width/2,Y:e.height+15,VY:-100}),bounds:new g([-15,10,15,10,15,0,0,-15,-15,0]),renderBounds:new y("#ff0",e.shipLayer)})}(t,e),e.lives--):e.phase==z.PLAYING&&(e.phase=z.LOST,it("#f00","G A M E")(t,e,0),it("#f00","O V E R")(t,e,.01),it("#888","Press C or Enter to restart")(t,e,.02)):e.respawnCooldown=2,e.debug.lives=e.lives}function ft(t,e,n){const{dx:s,dy:i,firing:o,weaponCycle:a}=e.playerInput,r=0!=s&&0!=i?.7:1;w(t,"playerShip","location","renderBounds","hp").forEach(([h,l,c,d,u])=>{const f=c.X<15,w=c.X>e.width-15;c.VX=f&&s<0||w&&s>0?0:300*s*r;const p=c.Y<15,g=c.Y>e.height-20;if(c.VY=p&&i<0?0:g&&i>=0?Math.min(c.VY,0):200*i*r,(a||0==e.availableWeapons[l.currentWeapon])&&(!function(t,e){if(e.availableWeapons.filter(t=>1==t).length>0)do{t.currentWeapon++,t.currentWeapon>e.availableWeapons.length&&(t.currentWeapon=0)}while(!e.availableWeapons[t.currentWeapon]);else t.currentWeapon=q.NONE}(l,e),e.debug.weapon=ht(l.currentWeapon)),o&&l.firingCooldown<=0)switch(l.currentWeapon){case q.SHOOTER:!function(t,e,n,s,i){n.firingCooldown=.2,rt(t,e,s,i,q.SHOOTER),N($)}(t,e,l,c.X,c.Y);break;case q.BACK_FLARE:!function(t,e,n,s,i){n.firingCooldown=.4,rt(t,e,s,i,q.BACK_FLARE,1.4*Math.PI,150),rt(t,e,s,i,q.BACK_FLARE,1.5*Math.PI,150),rt(t,e,s,i,q.BACK_FLARE,1.6*Math.PI,150),N($)}(t,e,l,c.X,c.Y)}else l.firingCooldown=Math.max(0,l.firingCooldown-n);l.mercyCooldown>0?(l.mercyCooldown=Math.max(0,l.mercyCooldown-n),d.color="#ff0",u.hp=9999):(d.color="#fff",u.hp=Math.min(u.hp,1))}),e.playerInput.weaponCycle=!1}class wt{constructor(t){this.nextLevel=t,this.waves=[],this.wave=0,this.cooldown=2,this.waitOnClear=!1,this.isTitleScreen=!1,this.bgColor=[0,0,0]}addWave(t,e){this.waves.push({pattern:t,cooldown:e})}tick(t,e,n){const s=0==w(t,"hp").filter(([t,{team:e}])=>e==K.ENEMY).length;if(this.cooldown>0)this.cooldown=Math.max(this.cooldown-n,0);else if(this.wave<this.waves.length&&(e.phase==z.PLAYING||this.isTitleScreen)){if(s||!this.waitOnClear){const n=this.waves[this.wave];this.cooldown=n.cooldown,this.waitOnClear=-1==n.cooldown,n.pattern.spawn(t,e),this.wave++}}else s&&e.phase==z.PLAYING&&(this.nextLevel?e.level=this.nextLevel:(e.phase=z.WON,it("#0f0","Victory!")(t,e,3),it("#8aa","Press C or Enter to restart")(t,e,3.02)));e.bgColor=e.bgColor.map((t,e)=>{const s=this.bgColor[e],i=s-t;return i>0?Math.min(s,t+500*n):i<0?Math.max(s,t-500*n):t})}}class pt{constructor(t,...e){this.minSpacing=t,this.spawners=e}spawn(t,e){const n=e.width-this.minSpacing,s=this.minSpacing*this.spawners.length,i=s+Math.random()*(n-s);let o=this.minSpacing/2+Math.random()*(n-i);const a=i/this.spawners.length;for(const n of this.spawners)n(t,e,o),o+=a}}class gt{constructor(t,...e){this.spacing=t,this.spawners=e}spawn(t,e){const n=this.spacing*this.spawners.length;let s=(this.spacing+e.width-n)/2;const i=n/this.spawners.length;for(const n of this.spawners)n(t,e,s),s+=i}}var mt;!function(t){t[t.SPAWNING=0]="SPAWNING",t[t.DWELLING=1]="DWELLING",t[t.DROPPING=2]="DROPPING",t[t.RISING=3]="RISING"}(mt||(mt={}));class bt{constructor(t=!1){this.bossMode=t,this.thinking=mt.SPAWNING,this.aiCooldown=0}}function yt(t,e,n){return d(t,{stalacfite:new bt,collisionSourceClass:new b("stalacfite"),collisionTargetClass:new b("stalacfite"),hp:new tt(K.ENEMY,300),location:new m({X:n,Y:-50,VY:100}),bounds:new g([-20,-30,0,40,20,-30]),renderBounds:new y("#a8f",e.shipLayer)})}function vt(t,e,n){return d(t,{stalacfite:new bt(!0),boss:new nt("Stalacfite DX"),collisionSourceClass:new b("stalacfite"),collisionTargetClass:new b("stalacfite"),hp:new tt(K.ENEMY,2e3),location:new m({X:n,Y:-150,VY:100}),bounds:new g([-50,0,0,150,50,0]),renderBounds:new y("#a8f",e.shipLayer)})}const Et=50;var Mt;!function(t){t[t.SPAWNING=0]="SPAWNING",t[t.DWELLING=1]="DWELLING",t[t.CHARGING=2]="CHARGING"}(Mt||(Mt={}));class Ct{constructor(t=!1,e=!1){this.bossMode=t,this.collapseMode=e,this.thinking=Mt.SPAWNING,this.aiCooldown=1}}function At(t,e,n,s=!1){return d(t,{swooparang:new Ct(!1,s),collisionSourceClass:new b("swooparang"),collisionTargetClass:new b("swooparang"),hp:new tt(K.ENEMY,150),location:new m({X:n,Y:-50,Angle:-Math.PI/2,VY:100*(Math.random()+.5)}),bounds:new g([-12,-30,0,-30,21,-21,30,0,21,21,0,30,-12,30,-12,21,0,21,12,0,0,-21,-12,-21]),renderBounds:new y(s?"#80f":"#8fa",e.shipLayer)})}function Wt(t,e,n){return At(t,e,n,!0)}function Lt(t,e,n){return d(t,{swooparang:new Ct(!0),boss:new nt("Heavy Swooparang"),collisionSourceClass:new b("swooparang"),collisionTargetClass:new b("swooparang"),hp:new tt(K.ENEMY,500),location:new m({X:n,Y:-50,Angle:-Math.PI/2,VY:250}),bounds:new g([-12,-30,0,-35,21,-21,30,0,21,21,0,35,-12,30,-12,21,0,21,12,0,0,-21,-12,-21]),renderBounds:new y("#f00",e.shipLayer)})}const Yt=300,Nt=Math.PI;class It extends wt{constructor(t){super(t),this.bgColor=[48,48,64],this.addWave(new gt(40,it("#ffa","Welcome to The Caves")),1),this.addWave(new pt(40,yt,yt,yt),5),this.addWave(new pt(100,yt,yt),2),this.addWave(new pt(40,yt,yt),2),this.addWave(new pt(40,yt,yt),2),this.addWave(new pt(40,yt,yt),2),this.addWave(new pt(50,yt,yt),1),this.addWave(new pt(60,yt,yt),3),this.addWave(new pt(40,yt,yt,yt,yt,yt),3),this.addWave(new pt(70,yt,yt,yt,yt),3),this.addWave(new pt(40,yt,yt,yt,yt,yt),4),this.addWave(new gt(100,vt),2)}}class St extends wt{constructor(t){super(t),this.bgColor=[220,154,105],this.addWave(new gt(40,it("#ff0","Welcome to The Plains")),1),this.addWave(new gt(40,it("#f00","Beware of Swooparangs")),3),this.addWave(new gt(100,At),-1),this.addWave(new gt(100,At,At),-1),this.addWave(new gt(100,At,At,At),-1),this.addWave(new gt(100,At,At),2),this.addWave(new pt(100,At,At),2),this.addWave(new pt(100,At,At),2),this.addWave(new pt(100,At,At,At,At),6),this.addWave(new pt(100,Lt),6)}}class xt extends wt{constructor(t){super(t),this.bgColor=[50,100,128],this.isTitleScreen=!0,this.cooldown=0,this.addWave(new gt(40,it("#f80","BURNED OUT")),.1),this.addWave(new gt(40,it("#fff","Controls:")),.1),this.addWave(new gt(40,it("#ccc","Z or Space: Fire Weapon")),.1),this.addWave(new gt(40,it("#ccc","X or Shift: Change Weapon")),.1),this.addWave(new gt(40,it("#cec","C or Enter: Start/Restart Game")),.1),this.addWave(new gt(40,it("#ccc","")),0),this.addWave(new gt(40,it("#caa","Defeating a boss sacrifices")),0),this.addWave(new gt(40,it("#caa","the weapon you beat it with")),.1)}}class Tt extends wt{constructor(t){super(t),this.bgColor=[0,0,0],this.addWave(new gt(40,it("#f80","ALERT!!!")),1),this.addWave(new gt(40,it("#f80","Welcome to The Collapse")),1),this.addWave(new pt(40,yt,yt,yt,yt,yt),1),this.addWave(new pt(40,yt,yt,yt),2),this.addWave(new gt(100,Wt),-1),this.addWave(new gt(100,Wt,Wt),-1),this.addWave(new pt(40,yt,yt,yt,yt,yt),1),this.addWave(new pt(40,yt,yt,yt,yt,yt),1),this.addWave(new gt(40,yt,yt,yt),1)}}let kt=class{constructor(t,e,n){this.canvas=t,this.cx=e,this.keys=n,this.world=new U(new xt),this.data=new J,this.gameLoop=new o(40,t=>{const{data:e,world:n}=this;this.world.playerInput.startGame&&(this.world.phase==z.TITLE?this.world.phase=z.PLAYING:this.reset(),this.world.playerInput.startGame=!1),ut(e,n,t),n.level.tick(e,n,t),ft(e,n,t),function(t,e,n){const{height:s,debug:i}=e;w(t,"stalacfite","location","hp").forEach(([i,o,a,r])=>{const h=o.aiCooldown>0;if(h&&(o.aiCooldown=Math.max(o.aiCooldown-n,0)),o.thinking!=mt.SPAWNING||h)if(o.thinking==mt.DWELLING){if(a.VY=Math.max(a.VY-70*n,0),o.bossMode){const e=w(t,"playerShip","location")[0];if(e){const t=e[2].X-a.X;Math.abs(t)>10?a.VX=150*Math.sign(t):a.VX=0}r.hp=Math.min(r.hp+150*n,2e3)}h||(o.thinking=mt.DROPPING)}else o.thinking==mt.DROPPING?(a.VY+=500*n,a.VX=0):o.thinking==mt.RISING&&(a.VY=-150);else o.thinking=mt.DWELLING,o.aiCooldown=1.5*Math.random()+.5;a.Y>s+Et?o.bossMode?o.thinking=mt.RISING:u(t,i):a.Y<-Et&&o.thinking==mt.RISING&&(o.thinking=mt.DWELLING,o.aiCooldown=2*Math.random()+1,new pt(40,yt,yt,yt,yt).spawn(t,e))})}(e,n,t),function(t,e,n){const{debug:s}=e,i=w(t,"playerShip","location")[0],o=i?i[2]:null;w(t,"swooparang","location","hp").forEach(([s,i,a,r])=>{const h=i.aiCooldown>0;if(h&&(i.aiCooldown=Math.max(i.aiCooldown-n,0)),i.thinking!=Mt.SPAWNING||h||(i.thinking=Mt.DWELLING),i.thinking==Mt.DWELLING&&(Math.abs(a.VX)>Yt*n?a.VX-=Math.sign(a.VX)*Yt*n:a.VX=0,Math.abs(a.VY)>Yt*n?a.VY-=Math.sign(a.VY)*Yt*n:a.VY=0,o)){let n=Math.atan2(a.Y-o.Y,o.X-a.X)-a.Angle%(2*Math.PI);n<-Math.PI&&(n+=2*Math.PI),n>Math.PI&&(n-=2*Math.PI),Math.abs(n)<.1?(a.VAngle=0,h||(i.thinking=Mt.CHARGING,i.aiCooldown=1,i.bossMode&&(rt(t,e,a.X,a.Y,q.NONE,a.Angle-.2,5,600,K.ENEMY),rt(t,e,a.X,a.Y,q.NONE,a.Angle+.2,5,600,K.ENEMY),N(j)))):a.VAngle=n<0?-Nt:Nt}i.thinking==Mt.CHARGING&&(a.VX+=400*Math.cos(a.Angle),a.VY-=400*Math.sin(a.Angle),!h&&(i.thinking=Mt.DWELLING,i.bossMode||(i.aiCooldown=1+Math.random()),i.collapseMode))&&new pt(40,yt,yt,yt).spawn(t,e)})}(e,n,t),function(t,e,n){const s=w(t,"message","location");s.sort(([{},{timeout:t},{}],[{},{timeout:e},{}])=>t-e);let i=e.height/3;s.forEach(([t,s,o])=>{s.targetY=i,i+=at;const a=s.targetY-o.Y;Math.abs(a)<100*n?(o.Y=s.targetY,o.VY=0):o.VY=100*Math.sign(a),o.X>=e.width/2&&s.timeout>=0?(o.X=e.width/2,s.timeout-=n,o.VX=0):e.phase==z.PLAYING&&(o.VX=e.width)})}(e,n,t),function(t,e){w(t,"location").forEach(([t,n])=>{n.X+=n.VX*e,n.Y+=n.VY*e,n.Angle+=n.VAngle*e})}(e,t),function(t,e,n){const s={};w(t,"collisionTargetClass","location","bounds").map(([t,n,i,o])=>{const a=M(o,i),r={id:t,class:n,poly:a};C(a,e).forEach(t=>{s[t]||(s[t]=[]),s[t].push(r)})}),w(t,"collisionSourceClass","location","bounds").map(([t,i,o,a])=>{const r=M(a,o),h={};C(r,e).forEach(t=>{if(s[t])for(const e of s[t])h[e.id[0]]=e});for(const e in h){const s=h[e];if(Y(r,s.poly)){const e=`${i.name}>${s.class.name}`;n(e,t,s.id)}}})}(e,50,(t,s,i)=>{!function(t,e,n,s,i){switch(n){case"bullet>player":case"bullet>stalacfite":case"bullet>swooparang":const[o]=f(e,s,"bullet"),[a,r]=f(e,i,"hp","boss");o&&a&&o.team!=a.team&&(a.hp-=o.attack,a.receivedDamage+=o.attack,t.score+=o.attack,o.hit=!0,N(H),r&&(r.killedBy=o.weapon))}}(n,e,t,s,i),function(t,e,n,s){switch(e){case"stalacfite>player":case"swooparang>player":const[n,i]=f(t,s,"playerShip","hp");n&&i&&(i.hp-=100)}}(e,t,0,i),function(t,e,n,s){switch(e){case"stalacfite>swooparang":const[i,o]=f(t,n,"stalacfite","hp"),[a,r]=f(t,s,"swooparang","hp");i&&o&&(o.hp=-1),a&&r&&(r.hp-=50,r.receivedDamage+=200)}}(e,t,s,i)}),function(t,e){w(t,"hp","location").forEach(([n,s,{X:i,Y:o}])=>{const a=Math.floor(s.receivedDamage/3);ct(t,e,i,o,2,"#000",a),s.receivedDamage=Math.floor(s.receivedDamage%3)})}(e,n),function(t,e){w(t,"boss","hp").filter(([t,e,{hp:n}])=>n<0).length>0&&w(t,"hp").filter(([t,e])=>e.team==K.ENEMY).forEach(([t,e])=>e.hp=0)}(e),function(t,e){w(t,"boss","hp").filter(([t,e,{hp:n}])=>n<=0).forEach(([n,s])=>{e.availableWeapons[s.killedBy]=!1,it("#0a4",`You defeated the ${s.name}!`)(t,e,0),it("#f40","But you had to sacrifice your")(t,e,.01),it("#f40",`${ht(s.killedBy)} to do it...`)(t,e,.02)})}(e,n),function(t,e){w(t,"hp").forEach(([n,s])=>{if(s.hp<=0){const[s,i]=f(t,n,"playerShip","location");null!=s?(N(F),null!=i&&(ct(t,e,i.X,i.Y,8,"#fa0",20),ct(t,e,i.X,i.Y,3,"#000",60))):(N(_),null!=i&&(ct(t,e,i.X,i.Y,5,"#fff",10),ct(t,e,i.X,i.Y,3,"#000",60))),u(t,n)}})}(e,n),function(t,{width:e,height:n,debug:s}){w(t,"location","bullet").forEach(([s,{X:i,Y:o},a])=>{(a.hit||i<-lt||i>e+lt||o<-lt||o>n+lt)&&u(t,s)})}(e,n),function(t,{width:e,height:n,debug:s}){w(t,"message","location").forEach(([n,s,{X:i,Y:o}])=>{i>2*e&&u(t,n)})}(e,n),function(t,e,n){w(t,"lifetime").forEach(([e,s])=>{s.time-=n,s.time<=0&&u(t,e)})}(e,0,t)},t=>{const{data:e,world:{phase:n,bgColor:[s,i,o]}}=this,a=new h;this.cx.fillStyle=`rgb(${s}, ${i}, ${o})`,this.cx.fillRect(0,0,this.world.width,this.world.height),function(t,e){e.queue(...w(t,"renderBounds","location","bounds").map(([t,{color:e,layer:n},s,{points:i}])=>n.toRender((t,n)=>{E(t,s,n),t.fillStyle=e,t.beginPath();for(let e=0;e<i.length;e+=2)t.lineTo(i[e],i[e+1]);t.fill("nonzero")})))}(e,a),function(t,e){e.queue(...w(t,"renderSprite","location").map(([t,{sheet:e,layer:n,index:s,offsetX:i,offsetY:o},a])=>n.toRender((t,n)=>{E(t,a,n),e.render(t,s,i,o)})))}(e,a),function(t,e){e.queue(...w(t,"message","location").map(([t,{layer:e,color:n,message:s},i])=>e.toRender((t,e)=>{E(t,i,e),t.font=`${ot}px monospace`,t.fillStyle=n,t.textAlign="center",t.textBaseline="middle",t.fillText(s,0,0)})))}(e,a),this.world.drawHud(a),a.draw(this.cx,t),n==z.WON||z.LOST}),this.gameLoop.start(),this.keys.focus(),this.reset()}reset(){this.world=new U(new xt(new It(new St(new Tt)))),this.data=new J,this.keys.setHandler(this.world.playerInput)}};kt=function(t,e,n,s){var i,o=arguments.length,a=o<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,s);else for(var r=t.length-1;r>=0;r--)(i=t[r])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([function(t,e=-1){return n=>{const s=document.querySelectorAll(t);for(let t=0;t<s.length;t++){const o=s[t];if(!(o instanceof HTMLCanvasElement))continue;const a=o.getContext("2d");new n(o,a,new i(o,e))}}}("#Shooter")],kt)}]);